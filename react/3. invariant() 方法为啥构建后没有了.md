# invariant() 方法为啥构建后没有了?

React 源代码中大量使用 invariant() 展示警告信息，然而在构建版本中这类代码自动被转换成了抛出错误的形式，这其中用到了自定义 babel 插件。本文将探讨 React 源代码如何运用自定义插件，以及如何自己写一个 babel 插件。

## [Warnings and Invariants](https://reactjs.org/docs/codebase-overview.html#warnings-and-invariants)

React 源码采用 warning 模块展示警告。
warning 仅在开发环境中启用。在生产环境中，他们会被完全剔除掉。如果你需要在生产环境禁止执行某些代码，请使用 invariant 模块代替 warning：

```js
var invariant = require('invariant');

invariant(
  2 + 2 === 4,
  'You shall not pass!'
);
```

当 invariant 判别条件为 false 时，会将 invariant 的信息作为错误抛出

“Invariant” 用于声明 “这个条件应总为 true”。你可以把它当成一种断言。

保持开发和生产环境的行为相似是十分重要的，因此 invariant 在开发和生产环境下都会抛出错误。不同点在于在生产环境中这些错误信息会被自动替换成错误代码，这样可以让输出库文件变得更小。

react-dom.development.js 文件会抛出这样的错：

```js
react-dom.development.js:26509 Uncaught Error: Target container is not a DOM element.
    at Object.render (react-dom.development.js:26509)
    at <anonymous>:49:10
    at run (babel.js:61531)
    at check (babel.js:61597)
    at loadScripts (babel.js:61638)
    at runScripts (babel.js:61668)
    at transformScriptTags (babel.js:336)
    at babel.js:327
```

react-dom.production.min.js 文件直接使用时 invariant 内容会被转换成抛出错误代码：

```js
react-dom.production.min.js:256 Uncaught Error: Minified React error #200; visit https://reactjs.org/docs/error-decoder.html?invariant=200 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.
    at Object.v.render (react-dom.production.min.js:256)
    at dev.html:31
v.render @ react-dom.production.min.js:256
(anonymous) @ dev.html:31
```

## 如何开发一个 babel 插件

官网开发指南 [Plugin Development](https://babeljs.io/docs/en/plugins#plugin-development) [handle-book](https://github.com/jamiebuilds/babel-handbook)


